!function(){"use strict";new Vue({el:"#app",data:{loadingMask:!0,api:"https://script.google.com/macros/s/AKfycbxC425IS9ntTUJ2k1rLzyDhKmj4R5wnyTS4JFaUnysctbQ1mXAO/exec",map:null,responseData:[],heatmapData:[],tabType:"confirmed",chart:{state:"",confirmed:0,recovered:0,death:0},chartCanvas:null,toast:!1,toastLoading:!0,translates:[]},methods:{getTranslate:function(){var e=this;return new Promise((function(t,a){fetch("https://spreadsheets.google.com/feeds/list/1gTzmvV0QG3t6_KOwvI9uNeUB9sNo3TjTQYRATpJ9jeE/1/public/values?alt=json").then((function(e){return e.json()})).then((function(a){e.translates=a.feed.entry,t()}))}))},initMap:function(){var e=this;fetch(this.api).then((function(e){return e.json()})).then((function(t){var a=e;e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:30.97564,lng:112.2707},zoom:5,mapTypeId:"roadmap",zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0,styles:[{elementType:"geometry",stylers:[{color:"#263238"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#FFD54F"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#746855"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"geometry.stroke",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#BCAAA4"}]},{featureType:"administrative.neighborhood",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#37474F"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#263238"}]}]});for(var o=[],r=t.confirmed,n=t.recovered,s=t.death,l=function(l,i){i=Object.keys(r[0]).length-1;var c,d,p=r[l]["Province/State"].replace("--",", ")||r[l]["Country/Region"].replace("--",", "),m={};m.id=l,m.stateEN=p,m.stateCH=(c=p,d="",Array.prototype.forEach.call(a.translates,(function(e){if(e.gsx$city.$t==c)return d=e.gsx$translate.$t})),""!=d?d:c),m.lat=r[l].Lat,m.lng=r[l].Long,m.confirmed=Number(r[l][Object.keys(r[0])[i]])||0,m.recovered=Number(n[l][Object.keys(n[0])[i]])||0,m.death=Number(s[l][Object.keys(s[0])[i]])||0,o.push(m);var y=new google.maps.LatLng(m.lat,m.lng),h=new google.maps.Marker({position:y,map:e.map}),f=new google.maps.InfoWindow({content:"\n                <h6>".concat(m.stateCH,"</h6>\n                <p>確診：").concat(m.confirmed,"</p>\n                <p>康復：").concat(m.recovered,"</p>\n                <p>死亡：").concat(m.death,'</p>\n                <button\n                  type="button"\n                  id="info-btn-').concat(m.id,'"\n                  class="btn btn-secondary btn-sm m-1 mt-2 for-mobile-up">\n                  <small>開啟圖表</small> \n                </button>\n              ')});m.openInfoWindow=function(){f.open(e.map,h)},f.addListener("domready",(function(a){document.getElementById("info-btn-".concat(m.id)).addEventListener("click",(function(a){e.openChartModal({state:"".concat(m.stateCH," ").concat(m.stateEn),count:{confirmed:m.confirmed,recovered:m.recovered,death:m.death},data:{confirmed:t.confirmed[l],recovered:t.recovered[l],death:t.death[l]}})}))})),h.addListener("click",(function(t){f.open(e.map,h),null!==a.chartCanvas&&a.destroyChart()}));var u={location:y,weight:m.confirmed};"Hubei"===r[l]["Province/State"]&&(u.weight=.15*m.confirmed),e.heatmapData.push(u)},i=0,c=r.length;i<c;i++)l(i,c);e.responseData=o.sort((function(e,t){return e.confirmed>t.confirmed?-1:1})),new google.maps.visualization.HeatmapLayer({data:e.heatmapData,dissipating:!0,radius:40}).setMap(e.map),e.loadingMask=!1}))},showCount:function(e,t,a){return"confirmed"===this.tabType?e:"recovered"===this.tabType?t:"death"===this.tabType?a:void 0},openChartModal:function(e){null!==this.chartCanvas&&this.destroyChart(),this.toast=!0,this.toastLoading=!0,this.chart.state=e.state,this.chart.confirmed=e.count.confirmed,this.chart.recovered=e.count.recovered,this.chart.death=e.count.death;var t=Object.keys(e.data.confirmed);t=t.slice(4,t.length);var a=Object.keys(e.data.recovered);a=a.slice(4,a.length);var o=Object.keys(e.data.death);o=o.slice(4,o.length);var r=[];Array.prototype.forEach.call(t,(function(e){r.push(e.split("/20")[0])}));var n=[],s=[],l=[];Array.prototype.forEach.call(t,(function(t){var a=Number(e.data.confirmed[t])||0;n.push(a)})),Array.prototype.forEach.call(a,(function(t){var a=Number(e.data.recovered[t])||0;s.push(a)})),Array.prototype.forEach.call(o,(function(t){var a=Number(e.data.death[t])||0;l.push(a)}));var i={type:"line",data:{labels:r,datasets:[{label:"確診",backgroundColor:"#2196F3",borderColor:"#2196F3",data:n,fill:!1},{label:"康復",backgroundColor:"#4CAF50",borderColor:"#4CAF50",data:s,fill:!1},{label:"死亡",backgroundColor:"#f44336",borderColor:"#f44336",data:l,fill:!1}]},options:{responsive:!0,tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"日期"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"人數"}}]}}},c=document.getElementById("data-chart").getContext("2d");this.chartCanvas=new Chart(c,i),this.toastLoading=!1},destroyChart:function(){this.toast=!1,this.chartCanvas.destroy()},moveMapCenter:function(e,t,a){var o=new google.maps.LatLng(e,t);this.map.panTo(o),a.openInfoWindow()}},created:function(){var e=this,t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBG9pWjn7gWHoqsNqTrU2EpWfZkyTlh6_I&libraries=visualization",document.head.appendChild(t),t.onload=function(){e.getTranslate().then((function(){return e.initMap()}))}}})}();