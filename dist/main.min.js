!function(){"use strict";new Vue({el:"#app",data:{loadingMask:!0,api:"https://script.google.com/macros/s/AKfycbxC425IS9ntTUJ2k1rLzyDhKmj4R5wnyTS4JFaUnysctbQ1mXAO/exec",map:null,responseData:[],heatmapData:[],tabType:"confirmed",chart:{state:"",confirmed:0,death:0},chartCanvas:null,toast:!1,toastLoading:!0,translates:[]},methods:{getTranslate:function(){var e=this;return new Promise((function(t,a){fetch("https://spreadsheets.google.com/feeds/list/1gTzmvV0QG3t6_KOwvI9uNeUB9sNo3TjTQYRATpJ9jeE/1/public/values?alt=json").then((function(e){return e.json()})).then((function(a){e.translates=a.feed.entry,t()}))}))},initMap:function(){var e=this;fetch(this.api).then((function(e){return e.json()})).then((function(t){var a=e;e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:43,lng:12},zoom:5,mapTypeId:"roadmap",zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0,styles:[{elementType:"geometry",stylers:[{color:"#263238"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#FFD54F"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#746855"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"geometry.stroke",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#BCAAA4"}]},{featureType:"administrative.neighborhood",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#37474F"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#263238"}]}]});for(var n=[],o=t.confirmed,r=t.death,s=function(s,i){i=Object.keys(o[0]).length-1;var l,c,p=o[s]["Province/State"].replace("--",", ")||o[s]["Country/Region"].replace("--",", "),d={};d.id=s,d.stateEN=p,d.stateCH=(l=p,c="",Array.prototype.forEach.call(a.translates,(function(e){if(e.gsx$city.$t==l)return c=e.gsx$translate.$t})),""!=c?c:l),d.lat=o[s].Lat,d.lng=o[s].Long,d.confirmed=Number(o[s][Object.keys(o[0])[i]])||0,d.death=Number(r[s][Object.keys(r[0])[i]])||0,n.push(d);var m=new google.maps.LatLng(d.lat,d.lng),y=new google.maps.Marker({position:m,map:e.map}),f=new google.maps.InfoWindow({content:"\n                <h6>".concat(d.stateCH,"</h6>\n                <p>確診：").concat(d.confirmed,"</p>\n                <p>死亡：").concat(d.death,'</p>\n                <button\n                  type="button"\n                  id="info-btn-').concat(d.id,'"\n                  class="btn btn-secondary btn-sm m-1 mt-2 for-mobile-up">\n                  <small>開啟圖表</small> \n                </button>\n              ')});d.openInfoWindow=function(){f.open(e.map,y)},f.addListener("domready",(function(a){document.getElementById("info-btn-".concat(d.id)).addEventListener("click",(function(a){e.openChartModal({state:"".concat(d.stateCH," ").concat(d.stateEN),count:{confirmed:d.confirmed,death:d.death},data:{confirmed:t.confirmed[s],death:t.death[s]}})}))})),y.addListener("click",(function(t){f.open(e.map,y),null!==a.chartCanvas&&a.destroyChart()}));var h={location:m,weight:d.confirmed};"Hubei"===o[s]["Province/State"]&&(h.weight=.15*d.confirmed),e.heatmapData.push(h)},i=0,l=o.length;i<l;i++)s(i,l);e.responseData=n.sort((function(e,t){return e.confirmed>t.confirmed?-1:1})),new google.maps.visualization.HeatmapLayer({data:e.heatmapData,dissipating:!0,radius:40}).setMap(e.map),e.loadingMask=!1}))},showCount:function(e,t){return"confirmed"===this.tabType?e:"death"===this.tabType?t:void 0},openChartModal:function(e){null!==this.chartCanvas&&this.destroyChart(),this.toast=!0,this.toastLoading=!0,this.chart.state=e.state,this.chart.confirmed=e.count.confirmed,this.chart.death=e.count.death;var t=Object.keys(e.data.confirmed);t=t.slice(4,t.length);var a=Object.keys(e.data.death);a=a.slice(4,a.length);var n=[];Array.prototype.forEach.call(t,(function(e){n.push(e.split("/20")[0])}));var o=[],r=[];Array.prototype.forEach.call(t,(function(t){var a=Number(e.data.confirmed[t])||0;o.push(a)})),Array.prototype.forEach.call(a,(function(t){var a=Number(e.data.death[t])||0;r.push(a)}));var s={type:"line",data:{labels:n,datasets:[{label:"確診",backgroundColor:"#2196F3",borderColor:"#2196F3",data:o,fill:!1},{label:"死亡",backgroundColor:"#f44336",borderColor:"#f44336",data:r,fill:!1}]},options:{responsive:!0,tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"日期"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"人數"}}]}}},i=document.getElementById("data-chart").getContext("2d");this.chartCanvas=new Chart(i,s),this.toastLoading=!1},destroyChart:function(){this.toast=!1,this.chartCanvas.destroy()},moveMapCenter:function(e,t,a){var n=new google.maps.LatLng(e,t);this.map.panTo(n),a.openInfoWindow()}},created:function(){var e=this,t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBG9pWjn7gWHoqsNqTrU2EpWfZkyTlh6_I&libraries=visualization",document.head.appendChild(t),t.onload=function(){e.getTranslate().then((function(){return e.initMap()}))}}})}();